<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Recipe</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body {
      background-image: url('/assets/images/edit.png');
      background-attachment: fixed;
      background-size: cover;
      background-position: center;
    }
  </style>
</head>
<body>
  <%- include('../partials/nav') %>
  <main>
    <h1>Edit Recipe</h1>
    <form action="/recipes/<%= recipe._id %>?_method=PUT" method="POST">
      <div>
        <label for="title">Title:</label>
        <input type="text" name="title" id="title" value="<%= recipe.title %>" required>
      </div>
      <div>
        <label for="ingredients">Ingredients (comma separated):</label>
        <input type="text" name="ingredients" id="ingredients" value="<%= recipe.ingredients.join(', ') %>" required>
      </div>
      <div>
        <label for="instructions">Instructions:</label>
        <textarea name="instructions" id="instructions" required><%= recipe.instructions %></textarea>
      </div>
      <div>
        <label for="majorRegion">Major Region:</label>
        <select id="majorRegion" name="majorRegion" required>
          <option value="">Select a major region</option>
          <option value="Asia" <%= recipe.region.major === "Asia" ? "selected" : "" %>>Asia</option>
          <option value="Europe" <%= recipe.region.major === "Europe" ? "selected" : "" %>>Europe</option>
          <option value="Africa" <%= recipe.region.major === "Africa" ? "selected" : "" %>>Africa</option>
          <option value="Americas" <%= recipe.region.major === "Americas" ? "selected" : "" %>>Americas</option>
          <option value="Oceania" <%= recipe.region.major === "Oceania" ? "selected" : "" %>>Oceania</option>
        </select>
      </div>
      <div>
        <label for="subRegion">Subregion:</label>
        <select id="subRegion" name="subRegion" required>
          <option value="">Select a subregion</option>
        </select>
      </div>
      <button type="submit">Update Recipe</button>
    </form>
    <a href="/recipes/<%= recipe._id %>" class="btn">Cancel</a>
  </main>
  <script src="/js/region-dropdown.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const majorRegionSelect = document.getElementById('majorRegion');
      const subRegionSelect = document.getElementById('subRegion');
      majorRegionSelect.dispatchEvent(new Event('change'));
      setTimeout(() => {
        subRegionSelect.value = "<%= recipe.region.sub %>";
      }, 100);
    });
  </script>
</body>
</html>
